<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>External Payload Storage - Conductor</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/custom.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "External Payload Storage";
    var mkdocs_page_input_path = "externalpayloadstorage.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Conductor</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../architecture/">Architecture</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../gettingstarted/basicconcepts/">Basic Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../gettingstarted/client/">Using the Client</a>
                </li>
                <li class="">
                    
    <a class="" href="../gettingstarted/startworkflow/">Start a Workflow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Configuration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../configuration/taskdef/">Task Definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/workflowdef/">Workflow Definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/systask/">System Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/eventhandlers/">Event Handlers</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/taskdomains/">Task Domains</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/isolationgroups/">Isolation Groups</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../server/">Conductor Server</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../apispec/">API Specification</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Conductor Metrics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../metrics/server/">Server Metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../metrics/client/">Client Metrics</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../extend/">Extending Conductor</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../tasklifecycle/">Task Lifecycle</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">External Payload Storage</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#context">Context</a></li>
    

    <li class="toctree-l2"><a href="#barriers">Barriers</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#soft-barrier">Soft Barrier</a></li>
        
            <li><a class="toctree-l3" href="#hard-barrier">Hard Barrier</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#usage">Usage</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#barriers-setup">Barriers setup</a></li>
        
            <li><a class="toctree-l3" href="#amazon-s3">Amazon S3</a></li>
        
            <li><a class="toctree-l3" href="#azure-blob-storage">Azure Blob Storage</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer Labs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../labs/beginner/">Beginner</a>
                </li>
                <li class="">
                    
    <a class="" href="../labs/eventhandlers/">Events and Event Handlers</a>
                </li>
                <li class="">
                    
    <a class="" href="../labs/kitchensink/">Kitchensink</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../bestpractices/">Best Practices</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../technicaldetails/">Technical Details</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../license/">License</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Conductor</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>External Payload Storage</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Netflix/conductor/edit/dev/docs/docs/externalpayloadstorage.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The external payload storage is currently only implemented to be used to by the Java client. Client libraries in other languages need to be modified to enable this.<br />
Contributions are welcomed.</p>
</div>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>Conductor can be configured to enforce barriers on the size of workflow and task payloads for both input and output.<br />
These barriers can be used as safeguards to prevent the usage of conductor as a data persistence system and to reduce the pressure on its datastore.</p>
<h2 id="barriers">Barriers<a class="headerlink" href="#barriers" title="Permanent link">&para;</a></h2>
<p>Conductor typically applies two kinds of barriers:</p>
<ul>
<li>Soft Barrier</li>
<li>Hard Barrier</li>
</ul>
<h4 id="soft-barrier">Soft Barrier<a class="headerlink" href="#soft-barrier" title="Permanent link">&para;</a></h4>
<p>The soft barrier is used to alleviate pressure on the conductor datastore. In some special workflow use-cases, the size of the payload is warranted enough to be stored as part of the workflow execution.<br />
In such cases, conductor externalizes the storage of such payloads to S3 and uploads/downloads to/from S3 as needed during the execution. This process is completely transparent to the user/worker process.  </p>
<h4 id="hard-barrier">Hard Barrier<a class="headerlink" href="#hard-barrier" title="Permanent link">&para;</a></h4>
<p>The hard barriers are enforced to safeguard the conductor backend from the pressure of having to persist and deal with voluminous data which is not essential for workflow execution.
In such cases, conductor will reject such payloads and will terminate/fail the workflow execution with the reasonForIncompletion set to an appropriate error message detailing the payload size.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<h3 id="barriers-setup">Barriers setup<a class="headerlink" href="#barriers-setup" title="Permanent link">&para;</a></h3>
<p>Set the following properties to the desired values in the JVM system properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>conductor.workflow.input.payload.threshold.kb</td>
<td>Soft barrier for workflow input payload in KB</td>
<td>5120</td>
</tr>
<tr>
<td>conductor.max.workflow.input.payload.threshold.kb</td>
<td>Hard barrier for workflow input payload in KB</td>
<td>10240</td>
</tr>
<tr>
<td>conductor.workflow.output.payload.threshold.kb</td>
<td>Soft barrier for workflow output payload in KB</td>
<td>5120</td>
</tr>
<tr>
<td>conductor.max.workflow.output.payload.threshold.kb</td>
<td>Hard barrier for workflow output payload in KB</td>
<td>10240</td>
</tr>
<tr>
<td>conductor.task.input.payload.threshold.kb</td>
<td>Soft barrier for task input payload in KB</td>
<td>3072</td>
</tr>
<tr>
<td>conductor.max.task.input.payload.threshold.kb</td>
<td>Hard barrier for task input payload in KB</td>
<td>10240</td>
</tr>
<tr>
<td>conductor.task.output.payload.threshold.kb</td>
<td>Soft barrier for task output payload in KB</td>
<td>3072</td>
</tr>
<tr>
<td>conductor.max.task.output.payload.threshold.kb</td>
<td>Hard barrier for task output payload in KB</td>
<td>10240</td>
</tr>
</tbody>
</table>
<h3 id="amazon-s3">Amazon S3<a class="headerlink" href="#amazon-s3" title="Permanent link">&para;</a></h3>
<p>Conductor provides an implementation of <a href="https://aws.amazon.com/s3/">Amazon S3</a> used to externalize large payload storage.<br />
Set the following property in the JVM system properties:</p>
<pre class="codehilite"><code>workflow.external.payload.storage=S3</code></pre>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This <a href="https://github.com/Netflix/conductor/blob/master/core/src/main/java/com/netflix/conductor/core/utils/S3PayloadStorage.java#L44-L45">implementation</a> assumes that S3 access is configured on the instance.</p>
</div>
<p>Set the following properties to the desired values in the JVM system properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>workflow.external.payload.storage.s3.bucket</td>
<td>S3 bucket where the payloads will be stored</td>
<td></td>
</tr>
<tr>
<td>workflow.external.payload.storage.s3.signedurlexpirationseconds</td>
<td>The expiration time in seconds of the signed url for the payload</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>The payloads will be stored in the bucket configured above in a <code>UUID.json</code> file at locations determined by the type of the payload. See <a href="https://github.com/Netflix/conductor/blob/master/core/src/main/java/com/netflix/conductor/core/utils/S3PayloadStorage.java#L149-L167">here</a> for information about how the object key is determined.</p>
<h3 id="azure-blob-storage">Azure Blob Storage<a class="headerlink" href="#azure-blob-storage" title="Permanent link">&para;</a></h3>
<p>ProductLive provides an implementation of <a href="https://azure.microsoft.com/services/storage/blobs/">Azure Blob Storage</a> used to externalize large payload storage.  </p>
<p>To build conductor with azure blob feature read the <a href="https://github.com/Netflix/conductor/blob/master/azureblob-storage/README.md">README.md</a> in <code>azureblob-storage</code> module </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This implementation assumes that you have an <a href="https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/storage/azure-storage-blob/README.md">Azure Blob Storage account's connection string or SAS Token</a>.
If you want signed url to expired you must specify a Connection String. </p>
</div>
<p>Set the following properties to the desired values in the JVM system properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>workflow.external.payload.storage.azure_blob.connection_string</td>
<td>Azure Blob Storage connection string. Required to sign Url.</td>
<td></td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.endpoint</td>
<td>Azure Blob Storage endpoint. Optional if connection_string is set.</td>
<td></td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.sas_token</td>
<td>Azure Blob Storage SAS Token. Must have permissions <code>Read</code> and <code>Write</code> on Resource <code>Object</code> on Service <code>Blob</code>. Optional if connection_string is set.</td>
<td></td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.container_name</td>
<td>Azure Blob Storage container where the payloads will be stored</td>
<td><code>conductor-payloads</code></td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.signedurlexpirationseconds</td>
<td>The expiration time in seconds of the signed url for the payload</td>
<td>5</td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.workflow_input_path</td>
<td>Path prefix where workflows input will be stored with an random UUID filename</td>
<td>workflow/input/</td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.workflow_output_path</td>
<td>Path prefix where workflows output will be stored with an random UUID filename</td>
<td>workflow/output/</td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.task_input_path</td>
<td>Path prefix where tasks input will be stored with an random UUID filename</td>
<td>task/input/</td>
</tr>
<tr>
<td>workflow.external.payload.storage.azure_blob.task_output_path</td>
<td>Path prefix where tasks output will be stored with an random UUID filename</td>
<td>task/output/</td>
</tr>
</tbody>
</table>
<p>The payloads will be stored as done in <a href="https://github.com/Netflix/conductor/blob/master/core/src/main/java/com/netflix/conductor/core/utils/S3PayloadStorage.java#L149-L167">Amazon S3</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../labs/beginner/" class="btn btn-neutral float-right" title="Beginner">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../tasklifecycle/" class="btn btn-neutral" title="Task Lifecycle"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/conductor/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../tasklifecycle/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../labs/beginner/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
